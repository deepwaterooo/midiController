#+latex_class: cn-article
#+latex_header: \lstset{language=c++,numbers=left,numberstyle=\tiny,basicstyle=\ttfamily\small,tabsize=4,frame=none,escapeinside=``,extendedchars=false,keywordstyle=\color{blue!70},commentstyle=\color{red!55!green!55!blue!55!},rulesepcolor=\color{red!20!green!20!blue!20!}}
#+title: MIDI Command Controller Interface
#+author: deepwaterooo

* Update 3/10/2015, updates include
** updates
- On the thread side, I just simply separate the detecting reading from Midi work into a thread, and connected the thread's signals with mainwindow slot function, and this makes the play and stop 100% responsive already. 
- Then I tried to light LED on for MIdi keys that I have pressed, and the LED on/off was not as repsonsive as I expected, would look into this later on;
- exchanged QSound with phonon module to satisfy my advisor's new increased requirements during last review meeting. 
- Phonon module is fully-functional by down-grading qt Creator from 5.3.x to 4.8.6 version and install phonon module, just need some extra work to fix minor bugs and satisfy the advisor's requirements (while I kept some buttons and toolbars and codes just for my debugging propose and convenience only, I could easily remove them later on according to the advisor's suggestions);
** other
- Last week my advisor complained that the hour I showed him too much code, he doesn't want to look into code that much yet. And he would rather help me with threads communications.
- After all my possible demos by commenting some codes out, even with threads, my advisor didn't offer any constructive suggestions. Gosh, I missed the mentor so much, who as the technical lead know programs and projects great, inspired and taught me sincerely and effectively during the internship.... 
- For this week's meeting, I am going to set my laptop into CSAC, so that I don't have to put everything on my knees and not formal and convenient at all. 
- Since my advisor doesn't want to review my codes, even he specificly checked for detail how I declared and initialized my playthread in my mainwindow.cpp file. Since I need to get graduated any way, and I have always been blocked and I have not set up the online full study plan yet, I would need to *discuss the graduation date and process* with my advisor today if I have any extra time. 
- Current GUI snapshot: 

[[./pic/Screenshot_from_2015-03-08_13:31:00.png]]
** Last week's meeting explain
 Last week's weekly meeting was cancelled by advisor, emails are attached below;

*** No meeting today?
(my advisor)@gmail.com [(my advisor)@gmail.com] on behalf of (my advisor) [(my advisor)@xxxxx.uxxxxx.edu]
You replied on 3/3/2015 9:47 AM.
Sent:	Tuesday, March 03, 2015 9:12 AM
To:	(me~~) ((me~~)@vandals.uxxxxx.edu)

Hi (me~~) - 

I have a deadline today - would it be possible to meet on thursday, 10:00 instead of today?

Thanks!

   - (my advisor)
*** RE: No meeting today?
(me~~) ((me~~)@vandals.uxxxxx.edu)
Sent:	Tuesday, March 03, 2015 9:47 AM
To:	
(my advisor) [(my advisor)@xxxxx.uxxxxx.edu]
Hi Dr. (My Advisor), 

Yes let's meet on Thursday 10:00am then. I will write to you if I have any conflict on that time if there is any by then (so far no conflicts). 

(explain: The reason I wrote this way was that I have short chats with recruitors on Tuesday and Wednesday, and there is NO reason that I should NOT put my job hunting for H1B sponshorship as my first priority. If I would have phone screen on Thursday, I don't want to it be blocked by the weekly review.)

Thanks,
(me~~)
*** Can't meet today
(my advisor)@gmail.com [(my advisor)@gmail.com] on behalf of (my advisor) [(my advisor)@xxxxx.uxxxxx.edu]
Sent:	Thursday, March 05, 2015 7:31 AM
To:	
Huang, (me~~) ((me~~)@vandals.uxxxxx.edu)
Hi (me~~) - 

I just realized that I have a thesis defense today at 9:30, so I can't meet today. Let's shoot for our regular time next week.

(explain: I guess my advisor simply forgot either my weekly review scheduled by himeself two days ago, or he simply forgot the student's defense which one he was interested. No problem with me at all. )

   - (my advisor)

* update 3/3/2015, meeting canceled for today
- The meeting was cancelled for today, will update some other day when this week's schedule get fixed.
* update 2/24/2015, updates include
** updates
- idol(3); moved to the correct position to paint GUI button responsively;
- modified "Play" key to be "Stop" playing a music key, set upper row last key as "STOP" key;
- made playing a song and stop the song become responsive (two operations in total) by implementing play the song through a thread; This way the "STOP" key could work;
- Issue is that only 2 operations responsive, but need to be always responsive. The reason for this failed could be playing thread didn't reinitialize as expected, or need another thread to always check midi user input, and I suspect the reason is more likely the latter; So moved to remove main GUI clicks step and use midi as the main input;
- I mean to use while loop, but even after the advisor approved the method, afterwards I realized that multi-threading is the more intuitive and correct way to do it, so skipped while loops;
- I packed my data array buffer into an object and include setter/getter; I should have read thread always checking midi input periodically; I should have write thread to write back to midi to light LED on; I was blocked slightly when finished reading but not implementing writing, I failed to read the data needed to play the song; will try this appoarch later;
- After get blocked using reading thread, I changed back to the advisor suggested using while loop way. As predicted, the main UI got blocked by the while loop, which still point/approve to the multi-threading appoarch;
- This is the first time that I realize such blocking problems, though I made quite some progress, and last week's meet suggestions/updates is NOT for one week to finish, rather eventual goals, so I am confident that eventually I would get all these problems solved;
- The write back to midi to light LED on for the key pressed, and methods are ready there already, I just need to make my threads work first, then use a thread to write back to midi when necessary, 
** other
- As listed above, review the play/stop details and issues, reading thread issues, and while loop issues sequencially and logically with advisor by demo all these different version, and show necessary codes parts;
- The project goal keeps the same, and the advisor actually maybe interested in "PAUSE" button and seekslider bar, and later if I have time, would work on that;
- For the followed several weeks, try to get a responsive softwares in fairly reasonable period. 

* Update 2/19/2014, updates include
** updates
- These are two sets in the MIDI keyboard, the 25 key main board, and the adjustment 8 keys;
- Corresponded the main keyboard keys with the same "surfinUSA.wav" song, and it works;
- Tested that all the 25 keys (I tested 4-5 keys by random sample) bonds to one song as a comand controller should work;
- Applied the same method on the left side 8 keys, but they are completely different set, so need further look into the sets ("Bend" could show key values, but the value could be changed to, and the other seven could NOT print Note ON/OFF values cause they are functionally different);
- GUI Interface keeps the same unchanged, so refer to last update for interface snapshot; 
- I have spent tons of hours on Emacs ever since Fall 2012 triggered by Emacs Lisp program hightlights, and I still got blocked by unexpected bugs from time to time, but still, have been blocked by thousands of times, I still like Emacs the most. Fully functional Emacs without bugs significantly improves efficiency for me. Now brought readme.tex and readme.pdf back, I like to have them before git update to avoid multiple unnecessary updates...
** todo
- So far linked to only one song, I have about 4-5, and need to link all of them to the keys (instead of link all the keys to the same song);
- Add two buttons for "Pause" and "Stop" in GUI to pause/stop playing a song;
- To light the midi controller LED on while the specific key pressed and light it on during the song time;
- Two set of input, midi controller and GUI buttons, prefer midi controller for input during tower show; The advisor said use an infinte loop for Checking midi input is ok, but I (me~) would expect to explore qt threads when loop is functional; The advisor expect that the midi controller should be responsive, so I should program to update midi-readin frequently (maybe even less than 500 ms interval according to the advisor);
- Though "the more information the better", the sliderbar is not necessary, I will list it as low priority.
- These are the suggestions that the advisor offered during morning meeting, and before the followed week meeting, I will try to finish as much as I can. 
** other issues
- The advisor and I rescheduled our meeting time to be 2:30pm on Wednesday afternoon because actually he has bi-weekly meeting at the original meeting time;
- Then I realize that I failed to state it clear that I need to work at 3pm means I needs to be well uniformly-dressed and be able to clock in and start work immediately, so we will have only about 15 minutes, and even advisor says I may start early, but I don't want to run to work late at times. 
- I wrote to the advisor and during yesterday's short meet we rescheduled the meeting time to be "*10:00am - 11:00am on Tuesday*" and for this week's meeting rescheduled to be this morning at 8:30am - 9:30am (the advisor showed up at 9:05, so we did have about half an hour meeting this morning. He had visitor at 9:30am). 
- Later on will update this repository weekly *around 11:00am within +/- 30 minutes* time period to help and enforce myself to make some progress weekly.

* Update 2/12/2014, updates include
** updates
- Didn't start until this week was mainly before the foot court work had waited more than one week to get docs processed, and waiting for work Schedule before Scheduling with advisor, and advisor approved it. 
- Scheduled Wednesday 12:30-1:30pm to meet advisor weekly, and will update at least once a week to record progress.
- For coming week's meeting, advisor suggested to get more keys combines with songs in the normal 25 key set besides the finished one. 
- Today got the Rectangle/Triangle shapes work and ready. 
[[./pic/Screenshot_from_2015-02-13_22:19:11.png]]

* Update 12/11/2014, updates include
** updates
- Temporatorily mimic phonon seekslider, but have not connected the signals and slots fully functioning yet;
- This seekslider may still eventually came back to use Phonon library using Qt4.8 version;
- So far consider this as a bonus feature;
[[./pic/Screenshot_from_2014-12-11_17:34:24.png]]
** review
- Because of lack Xbee modules (needs devices from intstructor), so far playing only .wav file is ok;
- It is basic, setting one buttone to work only, without any threads yet, but will expend it to be better during spring semester.
- Spring semester (1 credit) will pack all my instructor's Tower Play modules into a well-designed fully-functional softwares for user's convenience.
* Update 12/09/2014, updates include
- worked in it a little bit to set the connections between Midi controller and Qt Creator;
- tried to implement pthead for reading user input, but got slightly frustrated today, and applied easier methods instead;
- the project basically satisfied the instructor's requirements for connecting one key to work for playing his sequence, for example, Surfinusa.wav file;
- Will demo to his to see if he has better suggestions. 
* Update 11/23/2014, updates include
- Cleaned repository so that it looks clean and nice;
- Remove menubar as suggested by advisor;
- Removed topright four line texts cause it's not necessary;
- Shifted top line keys so that they look like original midi controller layout;
- Changed PlainTextEdit so that they satifies the requirements;
- Added left side 8 keys, just that three keys *Bend*, *-Oct*, *Oct+* are *NOT* like the original shapes yet, need work on them later on;
- Will link possible functionalities to make it a functional softwares first, and then updates minus issues.
- Current layout looks as below snapshotted: 

[[./pic/Screenshot_from_2014-11-23_13:20:06.png]]  
* Review 11/21/2014, updates include
** Review Contents
- Created most basic interface for the client, and reviewed with course instructor.
- Demo the most basic interface to him, and get corresponding specific requirements as listed followed.
  
[[./pic/2014-11-20_21:52:19.png]]
** Detailed Requirements
- menubar is NOT necessary, and could be removed away;
- Interface topright four line texts are not necessary, could be removed away;
- Interface top line keys should shift to the right by half key width so that the interface looks similar to the original midi controller keyboard;
- PlainTextEdit should be changed to be array of 25/33 lines of (text label, file name editor, browse QPushButton keys) layout;
- Left handside 8 keys should be included in the midi interface even functionalities are not required at this moment;
- When finished the above basic ones, if I have extra time, could explore the left side 8 keys to test if it is possible to use them to set a bunch of sequence so that save time when needed compared with set sequence one by one from the basic 25 keys.
* Project Requirements
- Use QuNexus Midi controller as a command controller to manipulate play sequence for tower lights show;
- Besides the main functionalities, create a Qt Creator Interface to help facilate the tower light playing process for clients convenience. 
* main functionality
** Read data from MIDI
  - Use the MIDI Controller as a speical Controller that can be operated to play specific songs sequence, or do some specific work.
  - play specific sequence may be the work for keys 0-9, and 10-12, how about other 20 keys? Do they require specific work to be done?
** Write data back to MIDI
  - When a key was pushed, the specific Controller key's LED is supposed to be on to indicate the operation. 
  - Trick about the LED to be continuously on is that when a key is pressed, that is 1 byte that indicates the "Duration" of the key press, I may need to 
    - try to set this byte to be a large value, (1 byte, 2^8 = 256, it has limits!)
    - or continuously reset is to be that large value;
    - or continuously write this key to be pressed data back to MIDI with time intervals
* Programming Language
** Qt
  - the worries that I have by using Qt is that if Qt has the capability to handle the MIDI-Linux connection problems. 
  - And also Qt-to-Audio (linux) connection things as well. Should it be Qt, or as far as I can set it to work in Linux, just let it be that way then?
** c++
  - I believe C++ is the most widely used Language used by those midi sequencer softwares, so I have no better choice than c++ right now. 
* Interface Design
  [[./pic/menu.png]]
  
  [[./pic/midi.jpg]]
* Midi keys and corresponded operations
  #+caption: midi keys and corresponded operations
  |---------+---------------------|
  | Keys    | Commands            |
  |---------+---------------------|
  | 10      |                     |
  | 11      |                     |
  | 12      |                     |
  | channel |                     |
  | Rotate  |                     |
  | CoMA    |                     |
  | Xpose   |                     |
  | Rec     |                     |
  | Stop    |                     |
  | Play    |                     |
  |---------+---------------------|
  | 0       | Call Me Maybe       |
  | 1       | Shake It Off        |
  | 2       | All About That Bass |
  | 3       | ...                 |
  | 4       |                     |
  | 5       |                     |
  | 6       |                     |
  | 7       |                     |
  | 8       |                     |
  | 9       |                     |
  |---------+---------------------|
  | Notes:  |                     |
  | CC      |                     |
  | Bend    |                     |
  | AftTch  |                     |
  | ChnPres |                     |
  |---------+---------------------|
  | Togl A  |                     |
  | Velo B  |                     |
  | Preset  |                     |
  | Pres C  |                     |
  | Tilt D  |                     |
  | Bend    |                     |
  | Oct-    |                     |
  | Oct+    |                     |
  |---------+---------------------|
* Interface Guide
  - Give text instructions on how to use the Interface, and what are the corresponded operations by press specific keys. 
  - Like list the above table in the Interface Guide text area. 
* References
** For circle QPushButton
- http://stackoverflow.com/questions/12734319/change-rectangular-qt-button-to-round
** Draw circle separate
- https://coderalbert.wordpress.com/2014/03/16/creating-circle-in-linux-using-qt-creator/
** For Rectangle Arc
- http://stackoverflow.com/questions/20416789/how-to-add-a-small-triangle-at-one-of-the-corners-of-qwidget
** PaintEvent Triangle
- http://stackoverflow.com/questions/20416789/how-to-add-a-small-triangle-at-one-of-the-corners-of-qwidget
- http://stackoverflow.com/questions/3894737/qt4-how-to-draw-inside-a-widget
- http://qt-project.org/forums/viewthread/1623
- http://stackoverflow.com/questions/7968269/basic-qt-gui-qpushbutton-for-drawing-a-line
** QPushButton::drawButton(QPainter *painter);
- https://www.tbi.univie.ac.at/~pmg/tutorials/QT/html/qpushbutton.html
** QGraphicsSene QGraphicsProxy...
- http://qt-project.org/forums/viewthread/4020
** QPushButton raised enabled
- http://www.qtcentre.org/threads/42852-QStyledItemDelegate-paint-QPushButton-with-stylesheet
** QPushButton two icons
- http://www.qtcentre.org/threads/39445-How-to-add-two-icons-images-to-the-same-QPushButton
** QPainter
- http://qt-project.org/forums/viewthread/23628
** QGridLayout ScrollArea
- http://qt-project.org/forums/viewthread/20843
- http://qt-project.org/forums/viewthread/20924/
** Linux Midi
- https://ccrma.stanford.edu/~craig/articles/linuxmidi/input/section1.html
- https://ccrma.stanford.edu/~craig/articles/linuxmidi/
** Open device
- http://pubs.opengroup.org/onlinepubs/009695399/functions/open.html
** Qt QIODevice
- http://doc.qt.digia.com/qq/qq12-iodevice.html
- http://stackoverflow.com/questions/14821792/what-does-file-openqiodevicereadonly-mean
** Qt Debugging
- https://bbs.archlinux.org/viewtopic.php?id=174523
- http://www.qtcentre.org/threads/53549-connect()-terminates-the-program
** pulseaudio linux mint
- http://community.linuxmint.com/software/view/pulseaudio
  #+begin_src c++
towerplayer  ./towerplayer Surfinusa.wav surfinUSA.tan
Loading Surfinusa.wav
File Size=26368316
Header Size=16
Data Size=26368272 (0x1925910)
Done reading tan file!
Checking for fast nodes
unable to open ftdi (xbee) device: -3 (device not found)
  #+end_src
** QSound example
- http://doc.qt.digia.com/3.3/sound-example.html
** QSound QSoundEffect(pulseaudio): Error Decoding course  
- https://together.jolla.com/question/53394/qsoundeffectpulseaudio-error-decoding-sourc/
** QTimer
- http://qt-project.org/forums/viewthread/27190
** Triangle
- http://en.wikibooks.org/wiki/Qt/Qt_Quick_Overview
- http://qt-project.org/forums/viewthread/25624
- http://stackoverflow.com/questions/24672146/qpainter-draw-lien
- http://doc.qt.digia.com/4.6/widgets-styles.html
- http://qt-project.org/doc/qt-4.8/painting-painterpaths-window-cpp.htm
** play loops
- http://stackoverflow.com/questions/16751778/qt-qsound-looping
- http://forum.codecall.net/topic/71902-qt-c-play-sound-on-key-press-stops-working-after-a-few-seconds/
** Phonon
- http://tuxradar.com/content/how-it-works-linux-audio-explained
- http://bbs.qter.org/forum.php?mod=viewthread&tid=784
- seek slider failed: http://pencil-animation.org/forum/viewtopic.php?id=672
- http://qt-project.org/doc/qt-4.8/phonon-qmusicplayer.html
- 
- 
** QThread
- http://www.360doc.com/content/12/0218/20/6828497_187676466.shtml
- http://www.360doc.com/content/12/1106/14/7899729_246182251.shtml
- http://qt-project.org/wiki/Threads_Events_QObjects_Chinese
- http://my.oschina.net/laopiao/blog/88158
- example http://blog.csdn.net/small_qch/article/details/6681907 
- http://www.kuqin.com/qtdocument/threads.html
- http://no001.blog.51cto.com/1142339/277004
- 
- 
- 

